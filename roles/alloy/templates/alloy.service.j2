{{ ansible_managed | comment }}
[Unit]
Description=Vendor-neutral programmable observability pipelines.
Documentation=https://grafana.com/docs/alloy/
Wants=network-online.target
After=network-online.target{{ ' ' + alloy_start_after_service if alloy_start_after_service is defined else '' }}

[Service]
Restart=always
User={{ alloy_service_user }}
Group={{ alloy_service_group }}
Environment=HOSTNAME=%H
EnvironmentFile={{ alloy_config_dir }}/{{ alloy_environment_file }}
WorkingDirectory={{ alloy_working_dir }}
ExecStart={{ alloy_installation_dir }}/alloy-linux-{{ alloy_arch }} run \
  $EXTRA_FLAGS \
  $CUSTOM_ARGS \
  --storage.path={{ alloy_working_dir }} \
  $CONFIG_FILE
ExecReload=/usr/bin/env kill -HUP $MAINPID
TimeoutStopSec=20s
SendSIGKILL=no

[Install]
WantedBy=multi-user.target